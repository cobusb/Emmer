#!/bin/bash

# Emmer Static Site Generator Build Script

set -e

# Default values
SOURCE_DIR=${1:-"content"}
OUTPUT_DIR=${2:-"dist"}
TEMPLATES_DIR=${3:-"templates"}
ASSETS_DIR=${4:-"assets"}
VERBOSE=${5:-"false"}

echo "🏗️  Building Emmer static site..."

# Check if Node.js and npm are available for CSS building
if command -v npm &> /dev/null; then
    echo "📦 Installing/updating Node.js dependencies..."
    npm install --silent

    echo "🎨 Building CSS..."
    npm run build:css:prod
else
    echo "⚠️  Node.js not found. Skipping CSS build."
    echo "   Install Node.js to enable automatic CSS generation."
fi

# Build the site
echo "📄 Building site from $SOURCE_DIR to $OUTPUT_DIR..."

elixir -e "
SiteEmmer.build([
  source_dir: \"$SOURCE_DIR\",
  output_dir: \"$OUTPUT_DIR\",
  templates_dir: \"$TEMPLATES_DIR\",
  assets_dir: \"$ASSETS_DIR\",
  verbose: $VERBOSE
])
"

echo "✅ Site built successfully!"
echo "📁 Output directory: $OUTPUT_DIR"
echo "🌐 Open $OUTPUT_DIR/index.html in your browser to view the site"
